id: kraken_passive_radar_eca_canceller
label: ECA Clutter Canceller
category: '[Kraken Passive Radar]'
flags: [python, cpp]

documentation: |-
  ECA-B (Extensive Cancellation Algorithm - Batched) Clutter Canceller
  
  Removes direct-path signal and static multipath clutter from surveillance 
  channels using the reference channel via adaptive filtering.
  
  Inputs:
    - Port 0: Reference channel (complex)
    - Ports 1-N: Surveillance channels (complex)
  
  Outputs:
    - Ports 0 to N-1: Clutter-cancelled surveillance channels (complex)
  
  Parameters:
    num_taps: Number of adaptive filter taps. Determines the maximum 
              clutter delay that can be cancelled (in samples).
    reg_factor: Tikhonov/diagonal loading regularization factor for 
                numerical stability. Typical values: 0.0001 to 0.01
    num_surv: Number of surveillance channels (typically 4 for KrakenSDR)

templates:
  imports: from gnuradio import kraken_passive_radar
  make: kraken_passive_radar.eca_canceller(${num_taps}, ${reg_factor}, ${num_surv})
  callbacks:
    - set_num_taps(${num_taps})
    - set_reg_factor(${reg_factor})

parameters:
  - id: num_taps
    label: Number of Taps
    dtype: int
    default: 128
    hide: none

  - id: reg_factor
    label: Regularization Factor
    dtype: float
    default: '0.001'
    hide: none

  - id: num_surv
    label: Surveillance Channels
    dtype: int
    default: 4
    hide: part

inputs:
  - domain: stream
    dtype: complex
    label: Ref

  - domain: stream
    dtype: complex
    multiplicity: ${num_surv}
    label: Surv

outputs:
  - domain: stream
    dtype: complex
    multiplicity: ${num_surv}
    label: Out

file_format: 1
